# Video Management API Documentation

This API provides endpoints to manage videos generated by the video generation service. It handles video metadata storage, status tracking, and Cloudinary integration.

## Base URL

```
http://localhost:3000/api/videos
```

## Authentication

The API requires a `userId` header for all requests. This header is used to identify the user and ensure they can only access their own videos.

```http
Headers:
userId: "user123"
```

## Endpoints

### 1. Create Video Record

Creates a new video record in the database.

```http
POST /api/videos
```

**Headers:**
```http
userId: "user123"
```

**Request Body:**
```json
{
  "videoId": "string",          // Required: Unique identifier for the video
  "cloudinaryUrl": "string",    // Required: URL of the video on Cloudinary
  "status": "processing",       // Optional: One of ["processing", "completed", "failed"]
  "metadata": {                 // Optional: Video metadata
    "duration": 0,              // Video duration in seconds
    "numScenes": 0,            // Number of scenes
    "numAudioSegments": 0,     // Number of audio segments
    "effects": ["string"],     // List of effects used
    "transitions": ["string"]  // List of transitions used
  }
}
```

**Response (201 Created):**
```json
{
  "userId": "user123",
  "videoId": "string",
  "cloudinaryUrl": "string",
  "status": "string",
  "metadata": {
    "duration": 0,
    "numScenes": 0,
    "numAudioSegments": 0,
    "effects": ["string"],
    "transitions": ["string"]
  },
  "createdAt": "2024-01-01T00:00:00.000Z",
  "updatedAt": "2024-01-01T00:00:00.000Z"
}
```

### 2. Get All Videos

Retrieves a list of all videos for the specified user.

```http
GET /api/videos
```

**Headers:**
```http
userId: "user123"
```

**Response (200 OK):**
```json
[
  {
    "userId": "user123",
    "videoId": "string",
    "cloudinaryUrl": "string",
    "status": "string",
    "metadata": {
      "duration": 0,
      "numScenes": 0,
      "numAudioSegments": 0,
      "effects": ["string"],
      "transitions": ["string"]
    },
    "createdAt": "2024-01-01T00:00:00.000Z",
    "updatedAt": "2024-01-01T00:00:00.000Z"
  }
]
```

### 3. Get Video by ID

Retrieves a specific video by its ID for the specified user.

```http
GET /api/videos/:id
```

**Headers:**
```http
userId: "user123"
```

**Response (200 OK):**
```json
{
  "userId": "user123",
  "videoId": "string",
  "cloudinaryUrl": "string",
  "status": "string",
  "metadata": {
    "duration": 0,
    "numScenes": 0,
    "numAudioSegments": 0,
    "effects": ["string"],
    "transitions": ["string"]
  },
  "createdAt": "2024-01-01T00:00:00.000Z",
  "updatedAt": "2024-01-01T00:00:00.000Z"
}
```

### 4. Update Video Status

Updates the status and metadata of a video for the specified user.

```http
PUT /api/videos/:id/status
```

**Headers:**
```http
userId: "user123"
```

**Request Body:**
```json
{
  "status": "string",          // Required: One of ["processing", "completed", "failed"]
  "metadata": {                // Optional: Additional metadata to update
    "duration": 0,
    "numScenes": 0,
    "numAudioSegments": 0,
    "effects": ["string"],
    "transitions": ["string"]
  }
}
```

**Response (200 OK):**
```json
{
  "userId": "user123",
  "videoId": "string",
  "cloudinaryUrl": "string",
  "status": "string",
  "metadata": {
    "duration": 0,
    "numScenes": 0,
    "numAudioSegments": 0,
    "effects": ["string"],
    "transitions": ["string"]
  },
  "createdAt": "2024-01-01T00:00:00.000Z",
  "updatedAt": "2024-01-01T00:00:00.000Z"
}
```

### 5. Delete Video

Deletes a video and its associated Cloudinary resource for the specified user.

```http
DELETE /api/videos/:id
```

**Headers:**
```http
userId: "user123"
```

**Response (200 OK):**
```json
{
  "message": "Video deleted successfully"
}
```

### 6. Get Video Status

Retrieves the current status and metadata of a video for the specified user.

```http
GET /api/videos/:id/status
```

**Headers:**
```http
userId: "user123"
```

**Response (200 OK):**
```json
{
  "status": "string",
  "metadata": {
    "duration": 0,
    "numScenes": 0,
    "numAudioSegments": 0,
    "effects": ["string"],
    "transitions": ["string"]
  }
}
```

## Error Responses

All endpoints may return the following error responses:

### 401 Unauthorized
```json
{
  "error": "User ID is required"
}
```

### 404 Not Found
```json
{
  "error": "Video not found"
}
```

### 500 Internal Server Error
```json
{
  "error": "Error message"
}
```

## Integration with Video Generation Service

To integrate with the video generation service:

1. When a video generation request is initiated:
   ```javascript
   // Create initial video record
   await fetch('http://localhost:3000/api/videos', {
     method: 'POST',
     headers: { 
       'Content-Type': 'application/json',
       'userId': 'user123'
     },
     body: JSON.stringify({
       videoId: 'generated-id',
       cloudinaryUrl: 'initial-url',
       status: 'processing'
     })
   });
   ```

2. When video generation is complete:
   ```javascript
   // Update video status
   await fetch('http://localhost:3000/api/videos/generated-id/status', {
     method: 'PUT',
     headers: { 
       'Content-Type': 'application/json',
       'userId': 'user123'
     },
     body: JSON.stringify({
       status: 'completed',
       metadata: {
         duration: 120,
         numScenes: 5,
         numAudioSegments: 3
       }
     })
   });
   ```

## Environment Variables

The API requires the following environment variables:

```env
PORT=3000
MONGODB_URI=your_mongodb_uri
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret
GENERATION_API_URL=your_generation_api_url
```

## Running the API

1. Install dependencies:
   ```bash
   npm install
   ```

2. Start the development server:
   ```bash
   npm run dev
   ```

3. For production:
   ```bash
   npm start
   ``` 